<nav class="navbar navbar-expand-lg sticky-top shadow-sm bg-gradient-navbar py-3">
  <div class="container">

    <!-- Brand -->
    <a class="navbar-brand fw-bold fs-4 text-white" href="{{ url_for('main.index') }}">
      BookBridge
    </a>

    <!-- Toggler -->
    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar links & search -->
    <div class="collapse navbar-collapse" id="navMain">
      
      <!-- Search -->
      <form class="d-flex ms-lg-4 my-2 my-lg-0 w-100 w-lg-auto" role="search" action="{{ url_for('books.browse') }}">
        <input class="form-control rounded-pill border-0 shadow-sm" 
               type="search" 
               name="q" 
               placeholder="Search books..." 
               aria-label="Search" 
               value="{{ request.args.get('q','') }}">
      </form>

      <!-- Links -->
      <ul class="navbar-nav ms-auto align-items-lg-center">

        <!-- Core Links -->
        <li class="nav-item"><a class="nav-link text-white fw-semibold" href="{{ url_for('books.browse') }}">Browse</a></li>
        <li class="nav-item"><a class="nav-link text-white fw-semibold" href="{{ url_for('books.create_book') }}">Sell / Donate</a></li>
        <li class="nav-item"><a class="nav-link text-white fw-semibold" href="{{ url_for('books.buy_requests') }}">Requests</a></li>

        {% if current_user.is_authenticated %}
          
          <!-- Wishlist -->
          <li class="nav-item">
  <a class="nav-link" href="{{ url_for('account.wishlist') }}">
    <i class="bi bi-heart"></i> Wishlist
  </a>
</li>


          <!-- Notifications -->
          <li class="nav-item ms-lg-3 position-relative">
            <a class="nav-link text-white fs-5" href="{{ url_for('account.notifications') }}" title="Notifications">
              <i class="bi bi-bell"></i> Notifications
              {% if g.get('notif_count') %}
                <span class="badge rounded-pill bg-warning position-absolute top-0 start-100 translate-middle">
                  {{ g.notif_count }}
                </span>
              {% endif %}
            </a>
          </li>

          <!-- My Listings -->
          <li class="nav-item ms-lg-3">
            <a class="nav-link text-white fw-semibold" href="{{ url_for('account.my_listings') }}">My Listings</a>
          </li>

          <!-- Profile Dropdown -->
          <li class="nav-item dropdown ms-lg-3">
            <a class="nav-link dropdown-toggle d-flex align-items-center text-white" href="#" role="button" data-bs-toggle="dropdown">
              {% set avatar = current_user.avatar_file %}
              <img src="{{ url_for('static', filename='avatars/' ~ avatar) if avatar else url_for('static', filename='img/avatar-placeholder.png') }}"
                   class="rounded-circle me-2 border border-white shadow-sm" alt="Avatar" width="32" height="32">
              <span class="fw-semibold">{{ current_user.name.split(' ')[0] }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow-lg rounded-3">
              <li><a class="dropdown-item" href="{{ url_for('account.profile') }}"><i class="bi bi-person me-2"></i>Profile</a></li>
              <li><a class="dropdown-item" href="{{ url_for('account.edit_profile') }}"><i class="bi bi-pencil-square me-2"></i>Edit Profile</a></li>
              <li><a class="dropdown-item" href="{{ url_for('account.change_password') }}"><i class="bi bi-key me-2"></i>Change Password</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
            </ul>
          </li>

        {% else %}
          <li class="nav-item ms-lg-2"><a class="btn btn-outline-light btn-sm rounded-pill" href="{{ url_for('auth.login') }}">Login</a></li>
          <li class="nav-item ms-lg-2"><a class="btn btn-outline-light btn-sm rounded-pill" href="{{ url_for('auth.signup') }}">Sign Up</a></li>
        {% endif %}

      </ul>
    </div>
  </div>
</nav>
